# ğŸ“Œ Proyecto 2 - Proyecto Final MLOps - Entrenamiento y Monitoreo de Modelos

Este proyecto implementa una arquitectura completa de MLOps que permite la orquestaciÃ³n, entrenamiento, registro y monitoreo de modelos de machine learning mediante servicios contenedorizados e integrados en una red comÃºn (`mlops_net`).

---

## ğŸ“¦ Estructura del Proyecto

```
PROYECTO_FINAL/
â”œâ”€â”€ app_back/
â”‚   â”œâ”€â”€ dockerfile_api
â”‚   â”œâ”€â”€ main.py
â”‚   â””â”€â”€ requirements_api.txt
â”œâ”€â”€ app_front/
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ dockerfile_stream
â”‚   â””â”€â”€ requirements_app.txt
â”œâ”€â”€ connections/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ connections.py
â”œâ”€â”€ dags/
â”‚   â””â”€â”€ pipeline.py
â”œâ”€â”€ grafana/
â”‚   â””â”€â”€ provisioning/
â”‚       â”œâ”€â”€ dashboards/
â”‚       â”‚   â””â”€â”€ fastapi_dashboard.json
â”‚       â”œâ”€â”€ datasources/
â”‚       â””â”€â”€ dashboards.yml
â”œâ”€â”€ logs/
â”œâ”€â”€ minio/
â”œâ”€â”€ mlflow/
â”‚   â”œâ”€â”€ dockerfile_mlflow
â”‚   â”œâ”€â”€ init.sql
â”‚   â””â”€â”€ requirements_mlflow.txt
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ columnas_entrenamiento.json
â”‚   â”œâ”€â”€ modelo_linear_regression_20250524_203129.pkl
â”‚   â”œâ”€â”€ modelo_linear_regression_20250526_215046.pkl
â”‚   â”œâ”€â”€ modelo_linear_regression_20250526_215231.pkl
â”‚   â””â”€â”€ modelo_mejor.pkl
â”œâ”€â”€ prometheus/
â”‚   â””â”€â”€ prometheus.yml
â”œâ”€â”€ docker-compose-airflow.yml
â”œâ”€â”€ docker-compose-mlflow.yml
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ dockerfile
â””â”€â”€ requirements.txt
â”œâ”€â”€ app_front/                 # Frontend con Streamlit
â”œâ”€â”€ connections/               # Conexiones a bases de datos
â”œâ”€â”€ dags/                      # DAGs de Airflow (pipeline unificado)
â”œâ”€â”€ grafana/                   # Dashboards y configuraciÃ³n
â”œâ”€â”€ logs/                      # Logs de Airflow
â”œâ”€â”€ minio/                     # Almacenamiento S3
â”œâ”€â”€ mlflow/                    # ConfiguraciÃ³n de MLflow
â”œâ”€â”€ models/                    # Modelos y artefactos generados
â”œâ”€â”€ prometheus/                # ConfiguraciÃ³n de Prometheus
â”œâ”€â”€ docker-compose.yml         # Base: MySQL, MinIO, API, Streamlit
â”œâ”€â”€ docker-compose-mlflow.yml  # Servicio MLflow
â”œâ”€â”€ docker-compose-airflow.yml# Servicios Airflow
```

---

## ğŸš€ Servicios principales

| Servicio     | Puerto | DescripciÃ³n |
|--------------|--------|-------------|
| **Airflow**  | `8080` | OrquestaciÃ³n del pipeline de datos |
| **MLflow**   | `8084` | Registro de experimentos y modelos |
| **MinIO**    | `9000`, `8083` | Almacenamiento tipo S3 para artefactos |
| **Streamlit**| `8501` | VisualizaciÃ³n de resultados |
| **FastAPI**  | `8000` | Backend API |
| **Grafana**  | `3000` | VisualizaciÃ³n de mÃ©tricas |
| **Prometheus** | `9090` | RecolecciÃ³n de mÃ©tricas |
| **MySQL**    | `3306` | Base de datos principal |

---

## ğŸ§ª Flujo del pipeline

1. **ExtracciÃ³n de datos desde API externa**
2. **Almacenamiento en MySQL (RAW)**
3. **Preprocesamiento, limpieza y divisiÃ³n (CLEAN)**
4. **Entrenamiento con `LinearRegression`**
5. **Registro de mÃ©tricas y modelos en MLflow**
6. **SelecciÃ³n y guardado del mejor modelo**
7. **Monitoreo de la API con Prometheus + Grafana**

---

## âš™ï¸ CÃ³mo ejecutar el proyecto

### 1. Crear red Docker externa

```bash
docker network create mlops_net
```

### 2. Levantar todos los servicios

```bash
docker compose -f docker-compose.yml \
               -f docker-compose-mlflow.yml \
               -f docker-compose-airflow.yml up -d --build
```

### 3. Acceder a las interfaces

- Airflow: [http://localhost:8080](http://localhost:8080)
- MLflow: [http://localhost:8084](http://localhost:8084)
- MinIO: [http://localhost:8083](http://localhost:8083)
- Streamlit: [http://localhost:8501](http://localhost:8501)
- Grafana: [http://localhost:3000](http://localhost:3000)

> Usuario y contraseÃ±a por defecto de Grafana: `admin / admin`

---

## ğŸ“ DAG principal (`pipeline.py`)

Se ejecuta secuencialmente en Airflow:

- `fase_1_extraccion`: consumo condicional de nuevos batches
- `fase_2_limpieza_y_division`: preprocesamiento y particiÃ³n en train/val/test
- `fase_3_entrenamiento_modelo`: entrenamiento y registro en MLflow + MinIO

---

## ğŸ“Œ Notas adicionales

- Los modelos son almacenados localmente y en MLflow (vÃ­a MinIO).
- Las mÃ©tricas se registran tambiÃ©n en base de datos para anÃ¡lisis posterior.
- El sistema puede ser extendido con alertas y despliegue de modelos vÃ­a API.
